!function(e){e.SUBMODULES_VERSION="1.0.0",e.SUBMODULES_VERNUM=0,e.namespaces={};class t{}class n{}function r(n){n in e.namespaces||(e.namespaces[n]=new t)}e.require=function(t){return r(t),e.namespaces[t]},e.namespace=function(t,o){r(t);var i=new n;for(var l in o(i),i)e.namespaces[t][l]=i[l]}}(this),namespace("com.subnodal.codeslate.engine",(function(e){var t=require("com.subnodal.codeslate.engine.input"),n=require("com.subnodal.codeslate.engine.design"),r=require("com.subnodal.codeslate.engine.formatter"),o=require("com.subnodal.codeslate.engine.gutter");e.CodeslateEngine=class{constructor(e,t={}){this.rootElement=e,this.options=t,this.id="";for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",r=0;r<16;r++)this.id+=n.charAt(Math.floor(Math.random()*n.length));var o=e.innerHTML;this.rootElement.innerHTML="",0!=this.options.autoInject&&this.inject(),this.code=o}get code(){var e="";return this.withPart("editorInput",(function(t){e=t.innerText.replace(/\n$/,"")})),e}set code(e){this.withPart("editorInput",(function(t){navigator.userAgent.toLowerCase().indexOf("firefox")>-1?t.innerText=e:t.innerText=e+"\n"})),this.render()}inject(){var e=this,n=document.createElement("style");n.setAttribute("cse-part","style");var r=document.createElement("div");r.setAttribute("cse-part","editorSpace");var i=document.createElement("div");i.setAttribute("cse-part","editorGutter"),r.appendChild(i);var l=document.createElement("div");l.setAttribute("cse-part","editorInput"),l.setAttribute("contenteditable","true"),l.setAttribute("spellcheck","false");var a=document.createElement("div");a.setAttribute("cse-part","editorMeasurer"),a.setAttribute("aria-hidden","true"),r.appendChild(l),r.appendChild(a),this.rootElement.appendChild(n),this.rootElement.appendChild(r),this.rootElement.setAttribute("dir","ltr"),this.rootElement.setAttribute("cse-id",this.id),t.register(this),this.render(),setTimeout((function(){o.render(e,!0)}))}render(e=0,t=null){var o=this,i=!1;return null==t&&(t=this.code.split("\n").length),this.withPart("style",(function(e){e.innerHTML=n.createStyler(o).generate(o)})),this.withPart("editorInput",(function(n){i=r.format(o,n,e,t)||i})),i}withPart(e,t){for(var n=this.rootElement.querySelectorAll(`[cse-id="${this.id}"] [cse-part="${e}"]`),r=0;r<n.length;r++)t(n[r],r)}}})),namespace("com.subnodal.codeslate.engine.input",(function(e){var t=require("com.subnodal.codeslate.engine.measurer"),n=require("com.subnodal.codeslate.engine.gutter"),r=null,o=null,i=null,l=0,a=0,s=[];e.Selection=class{constructor(e,t){this.start=e,this.end=t}},e.saveSelection=function(t){if(0==window.getSelection().rangeCount)return new e.Selection(0,0);var n=window.getSelection().getRangeAt(0),r=n.cloneRange();return r.selectNodeContents(t),r.setEnd(n.startContainer,n.startOffset),new e.Selection(r.toString().length,r.toString().length+n.toString().length)},e.restoreSelection=function(e,t){var n=0,r=document.createRange();r.setStart(e,0),r.collapse(!0);for(var o=[e],i=null,l=!1,a=!1;!a&&(i=o.pop());)if(i.nodeType==Node.TEXT_NODE){var s=n+i.length;!l&&t.start>=n&&t.start<=s&&(r.setStart(i,t.start-n),l=!0),l&&t.end>=n&&t.end<=n&&(r.setEnd(i,t.end-n),a=!0),n=s}else for(var c=i.childNodes.length;c--;)o.push(i.childNodes[c]);var d=window.getSelection();d.removeAllRanges(),d.addRange(r)},e.getCurrentLinePosition=function(t){var n=0;return t.withPart("editorInput",(function(t){n=t.innerText.substring(0,e.saveSelection(t).start).split("\n").length-1})),n},e.register=function(c){c.withPart("editorInput",(function(d){function u(r=!1){var i=e.saveSelection(d);n.render(c),null==o&&(o=t.getLineTopDistances(c));for(var l=0,s=0,u=0;u<o.length&&!(o[l+1]>d.scrollTop);u++)l++;for(u=0;u<o.length&&!(o[s+1]>d.scrollBottom);u++)s++;Math.abs((r?l:s)-a)<25||(a=l,c.render(Math.max(l-50,0),l+100)&&e.restoreSelection(d,i))}i=e.getCurrentLinePosition(c),d.addEventListener("keydown",(function(t){if(9==t.keyCode&&t.preventDefault(),13==t.keyCode){o=null,i=e.getCurrentLinePosition(c);for(var n=d.innerText.split("\n")[i],r=(c.options.languageData||{}).indentOpenChars||[],l=0,a=0;a<r.length;a++)if(n.match(new RegExp(r[a].length>1?`${r[a]}$`:`\\${r[a]}$`))){l++;break}document.execCommand("insertHTML",!1,"\n"+(c.options.indentWithTab?"\t":" ").repeat(n.search(/\S|$/)+l*(c.options.indentBy||4))),t.preventDefault()}8==t.keyCode&&"\n"==d.innerHTML&&t.preventDefault(),38==t.keyCode&&i>0?i--:(40==t.keyCode||13==t.keyCode)&&i<d.innerHTML.split("\n").length&&i++})),d.addEventListener("click",(function(t){i=e.getCurrentLinePosition(c),a=0,s=[],u(),n.setIndentMarkers(s)})),d.addEventListener("keyup",(function(t){var l=e.saveSelection(d);if(!(65==t.keyCode&&t.ctrlKey||17==t.keyCode)){if(9==t.keyCode){o=null,i=e.getCurrentLinePosition(c),l.start=l.end,e.restoreSelection(d,l),o=null;var a=d.innerHTML.split("\n"),u=0;if(0==s.length)for(var p=i;p<=e.getCurrentLinePosition(c);p++)s.push(p);for(p=0;p<s.length;p++){var g=s[p],h=Math.floor(a[g].search(/\S|$/)/(c.options.indentBy||4)),f=(c.options.indentBy||4)-a[g].search(/\S|$/)%(c.options.indentBy||4);t.shiftKey?(a[g].search(/\S|$/)>0&&(u-=f),h*(c.options.indentBy||4)>0&&(a[g]=(c.options.indentWithTab?"\t":" ").repeat((h-1)*(c.options.indentBy||4))+a[g].trimStart())):(a[g]=(c.options.indentWithTab?"\t":" ").repeat(f)+a[g],u+=f)}d.innerHTML=a.join("\n"),l.end+=u,l.start=l.end,e.restoreSelection(d,l),t.preventDefault(),n.setIndentMarkers(s)}else 16!=t.keyCode&&(s=[],n.setIndentMarkers(s));if(9!=t.keyCode&&16!=t.keyCode&&37!=t.keyCode&&38!=t.keyCode&&39!=t.keyCode&&40!=t.keyCode){var m=(c.options.languageData||{}).indentCloseChars||[],y=(a=d.innerHTML.split("\n"),d.innerText.split("\n")),b=!1;for(p=0;p<m.length;p++)if(y[i].match(new RegExp(m[p].length>1?`^\\s*?${m[p]}$`:`^\\s*?\\${m[p]}$`))){l.start-=Math.min(a[i].search(/\S|$/),c.options.indentBy||4),l.end-=Math.min(a[i].search(/\S|$/),c.options.indentBy||4),a[i]=a[i].replace(new RegExp(`^\\s{0,${c.options.indentBy||4}}`),""),b=!0;break}b&&(d.innerHTML=a.join("\n"),e.restoreSelection(d,l))}c.render(Math.max(i-50,0),i+50)&&(e.restoreSelection(d,l),o=null),null!=r&&clearTimeout(r),r=setTimeout((function(){n.render(c,!0)}),100),window.getSelection().getRangeAt(0).getBoundingClientRect().left<d.getBoundingClientRect().left&&(d.scrollLeft=0),window.getSelection().getRangeAt(0).getBoundingClientRect().top>d.getBoundingClientRect().bottom-parseInt(getComputedStyle(d).paddingBottom)&&(d.scrollTop=d.scrollHeight+(d.offsetHeight-d.clientHeight)),33!=t.keyCode&&34!=t.keyCode||(i=e.getCurrentLinePosition(c)),37!=t.keyCode&&39!=t.keyCode&&8!=t.keyCode||window.getSelection().getRangeAt(0).getBoundingClientRect().left-d.offsetLeft<10&&(i=e.getCurrentLinePosition(c))}})),d.addEventListener("paste",(function(e){setTimeout((function(){o=null,a=0,s=[],u(),n.setIndentMarkers(s)}),1e3)})),d.addEventListener("scroll",(function(){u(d.scrollTop<l),l=d.scrollTop}))}))}})),namespace("com.subnodal.codeslate.engine.styler",(function(e){e.Styler=class{constructor(e=[]){this.styleCollection=e}generate(e){for(var t="",n=0;n<this.styleCollection.length;n++)t+=`[cse-id="${e.id}"] [cse-part="${this.styleCollection[n].part}"]${this.styleCollection[n].specification} {${this.styleCollection[n].rules}}`;return t}},e.Style=class{constructor(e,t,n=""){this.part=e,this.rules=t,this.specification=n}}})),namespace("com.subnodal.codeslate.engine.design",(function(e){var t=require("com.subnodal.codeslate.engine.styler");e.defaultTheme={codeFont:'"Overpass Mono", "Roboto Mono", monospace',uiFont:'"Overpass", "Roboto", sans-serif',background:"#072047",gutter:"#0b2f68",lineNumber:"#98b4e0",lineNumberIndent:"white",caret:"#dbe21e",scrollbar:"rgba(255, 255, 255, 0.5)",scrollbarHover:"rgba(255, 255, 255, 0.6)",scrollbarPressed:"rgba(255, 255, 255, 0.8)",selection:"#4688f2",text:"white",definition:"#1ee2ae; font-weight: bold;",keyword:"#1ee2ae",string:"#1faee2",number:"#a0c5ff",operator:"#448dff",atom:"#1faee2",comment:"#536889; font-style: italic;",regex:"#1faee2"},e.createStyler=function(n){var r=new t.Styler;function o(e){r.styleCollection.push(e)}var i=n.options||{},l={...e.defaultTheme,...i.theme||{}};return o(new t.Style("editorSpace",`\n            position: relative;\n            width: 100%;\n            height: 100%;\n            background-color: ${l.background};\n            font-size: 16px;\n            font-family: ${l.uiFont};\n            overflow: hidden;\n        `)),o(new t.Style("editorGutter",`\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 3em;\n            height: 100%;\n            background-color: ${l.gutter};\n            font-family: ${l.codeFont};\n        `)),o(new t.Style("editorGutterLine",`\n            position: absolute;\n            right: 0.5em;\n            color: ${l.lineNumber};\n            user-select: none;\n        `)),o(new t.Style("editorGutterLine",`\n            color: ${l.lineNumberIndent};\n            font-weight: bold;\n        `,'[cse-indentmarker="true"]')),o(new t.Style("editorInput",`\n            position: relative;\n            display: inline-block;\n            top: 0;\n            left: 3em;\n            width: calc(100% - 3.2em);\n            height: calc(100% - 2em);\n            padding-bottom: 2em;\n            padding-left: 0.2em;\n            font-family: ${l.codeFont};\n            line-height: 20px;\n            color: ${l.text};\n            overflow: auto;\n            white-space: ${i.wordWrap?"pre-wrap":"pre"};\n            word-break: ${i.wordWrap?"break-all":"keep-all"};\n            tab-size: ${i.tabWidth||8};\n            outline: none;\n            caret-color: ${l.caret};\n        `)),o(new t.Style("editorInput",`\n            background: ${l.selection};\n        `,"::selection")),o(new t.Style("editorInput","\n            width: 15px;\n            height: 15px;\n        ","::-webkit-scrollbar")),o(new t.Style("editorInput","\n            width: 0;\n            height: 0;\n        ","::-webkit-scrollbar-button")),o(new t.Style("editorInput",`\n            background-color: ${l.scrollbar};\n            border: 2px solid transparent;\n            border-radius: 10px;\n            opacity: 0.5;\n            background-clip: padding-box;\n        `,"::-webkit-scrollbar-thumb")),o(new t.Style("editorInput",`\n            background-color: ${l.scrollbarHover};\n        `,"::-webkit-scrollbar-thumb:hover")),o(new t.Style("editorInput",`\n            background-color: ${l.scrollbarPressed};\n        `,"::-webkit-scrollbar-active")),o(new t.Style("editorInput","\n            background-color: transparent;\n        ","::-webkit-scrollbar-track")),o(new t.Style("editorInput","\n            background-color: transparent;\n        ","::-webkit-scrollbar-corner")),o(new t.Style("editorMeasurer",`\n            position: absolute;\n            top: 0;\n            left: 3em;\n            width: calc(100% - 3.2em);\n            padding-left: 0.2em;\n            font-family: ${l.codeFont};\n            line-height: 20px;\n            color: ${l.text};\n            overflow: auto;\n            white-space: ${i.wordWrap?"pre-wrap":"pre"};\n            word-break: ${i.wordWrap?"break-all":"keep-all"};\n            visibility: hidden;\n        `)),o(new t.Style("syntax",`\n            background-color: ${l.selection};\n        `,"::selection")),o(new t.Style("syntax",`\n            color: ${l.definition};\n        `,"[cse-syntax='definition']")),o(new t.Style("syntax",`\n            color: ${l.keyword};\n        `,"[cse-syntax='keyword']")),o(new t.Style("syntax",`\n            color: ${l.string};\n        `,"[cse-syntax='string']")),o(new t.Style("syntax",`\n            color: ${l.number};\n        `,"[cse-syntax='number']")),o(new t.Style("syntax",`\n            color: ${l.operator};\n        `,"[cse-syntax='operator']")),o(new t.Style("syntax",`\n            color: ${l.atom};\n        `,"[cse-syntax='atom']")),o(new t.Style("syntax",`\n            color: ${l.comment};\n        `,"[cse-syntax='comment']")),o(new t.Style("syntax",`\n            color: ${l.regex};\n        `,"[cse-syntax='regex']")),r}})),namespace("com.subnodal.codeslate.engine.formatter",(function(e){const t="",n="";function r(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function o(e){return e.trim().replace(/&nbsp;/g," ").replace(/<div>/g,"").replace(/<\/div>/g,"").replace(/<br>/g,"").replace(/\n/g,"").trim()}e.format=function(e,i,l,a){for(var s,c=(e.options||{}).languageData||{},d=r(i.innerText).split("\n"),u=(s=r(function(e,r){for(var o=0;o<r.length;o++){var i=r[o];e=e.replace(new RegExp("(?<!)(?:"+(i.regex||"")+")(?![^]*)","g"+(i.flags||"")),(function(){return t+(i.type||"")+(i.spellcheck?"":"")+(i.before||"")+arguments[Number(i.match||0)]+(i.after||"")+n}))}return e}(i.innerText.split("\n").slice(l,a).join("\n"),c.syntax||{})),s.replace(new RegExp(t,"g"),'<span cse-part="syntax" cse-syntax="').replace(new RegExp("","g"),'">').replace(new RegExp(n,"g"),"</span>").replace(new RegExp("","g"),'" spellcheck="true">')).split("\n"),p=0;p<u.length;p++)l+p<d.length&&(d[l+p]=u[p]);var g="";for(p=0;p<d.length;p++)g+=`${d[p]}\n`;return o(i.innerHTML)!=o(g)&&(i.innerHTML=g.replace(/\n$/,""),!0)}})),namespace("com.subnodal.codeslate.engine.measurer",(function(e){e.getLineTopDistances=function(e,t=0,n=null){var r=null;t=Math.max(t,0);var o=new Array(t).fill(0);return e.withPart("editorMeasurer",(function(e){r=e})),e.withPart("editorInput",(function(e){var i=e.innerHTML.split("\n");null==n&&(n=i.length),r.innerHTML=i.slice(0,t).join("\n"),r.style.width=e.clientWidth-(e.offsetWidth-e.clientWidth)+10+"px";for(var l=t;l<n;l++)o.push(r.clientHeight),r.innerHTML+=i[l]+"\n";o.pop()})),o}})),namespace("com.subnodal.codeslate.engine.gutter",(function(e){var t=require("com.subnodal.codeslate.engine.measurer"),n=null,r=null;e.render=function(e,o=!1,i=0,l=null){var a=!1;(null==n||o)&&(n=t.getLineTopDistances(e,i,l),r!=n.length&&(a=!0,r=n.length));var s=null;e.withPart("editorInput",(function(e){s=e})),e.withPart("editorMeasurer",(function(e){e})),e.withPart("editorGutter",(function(e){a&&(e.innerHTML="");for(var t=0;t<r;t++){var o=null,i=!1;if(e.querySelectorAll(`[cse-part="editorGutterLine"][cse-line="${t}"]`).length>0?o=e.querySelectorAll(`[cse-part="editorGutterLine"][cse-line="${t}"]`)[0]:((o=document.createElement("div")).setAttribute("cse-part","editorGutterLine"),o.setAttribute("cse-line",String(t)),i=!0),o.innerText=String(t+1),o.style.top=String(n[t]-s.scrollTop)+"px",i&&n[t]-s.scrollTop>-50&&e.appendChild(o),t==r-1){var l=o.clientWidth+parseInt(getComputedStyle(o).fontSize);l=Math.max(l,3*parseInt(getComputedStyle(o).fontSize)),e.style.width=l+"px",s.style.left=l+"px",s.style.width=`calc(100% - ${l+3}px)`}}}))},e.setIndentMarkers=function(e){cseInstance.withPart("editorGutter",(function(t){for(var n=t.querySelectorAll('[cse-part="editorGutterLine"]'),r=0;r<n.length;r++)n[r].removeAttribute("cse-indentmarker");for(r=0;r<e.length;r++){var o=e[r];t.querySelectorAll(`[cse-part="editorGutterLine"][cse-line="${o}"]`)[0].setAttribute("cse-indentmarker","true")}}))}}));